fill = color1,
color = color1
)
) +
geom_bar(
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label
),
family = "flama",
position = position_dodge(width = .9),
hjust = nudge,
size = percent_size
) +
scale_fill_manual(
values = c(color1)
) +
scale_color_manual(
guide = FALSE,
values = c(color1)
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = 14),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.x = element_blank(),
strip.text = element_text(size = 12),
legend.position = "none"
) +
coord_flip()
}
groupedbar <- function(
data = frequencies,
result = frequencies$result,
label = frequencies$label,
source = frequencies$group_var,
percent_label = frequencies$percent_label,
spaces = 10,
percent_size = 10,
axis_text_size = 12
) {
chart <- ggplot(
frequencies,
aes(
x = label,
y = result,
group = source
)
) +
geom_bar(
aes(
fill = source
),
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label,
color = source
),
family = "flama",
position = position_dodge(width = .9),
vjust = -.5,
size = percent_size
) +
scale_fill_manual(
values = region_colors
) +
scale_color_manual(
guide = FALSE,
values = region_colors
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = axis_text_size),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.y = element_blank(),
strip.text = element_text(size = 12),
legend.position = "top"
)
}
groupedbar_hor <- function(
data = frequencies,
result = frequencies$result,
label = frequencies$label,
source = frequencies$group_var,
percent_label = frequencies$percent_label,
spaces = 100,
percent_size = 10,
axis_text_size = 12,
colors = region_colors,
nudge = -.35
) {
chart <- ggplot(
frequencies,
aes(
x = label,
y = result,
group = source
)
) +
geom_bar(
aes(
fill = source
),
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label,
color = source
),
family = "flama",
position = position_dodge(width = .9),
hjust = nudge,
size = percent_size
) +
scale_fill_manual(
values = colors
) +
scale_color_manual(
guide = FALSE,
values = colors
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = axis_text_size),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.x = element_blank(),
strip.text = element_text(size = 12),
legend.position = "top"
) +
guides(fill = guide_legend(reverse = T)) +
coord_flip()
}
names <- names(responses)
names <- names(responses) %>% as.tibble()
names <- names(responses) %>% as_tibble()
View(names)
responses %>% freqs(QAGEGROUP)
responses %>% freqs(QAGEGROUP) %>%
mutate(
percent_label = case_when(
label = label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
)
)
responses %>% freqs(QAGEGROUP) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
)
)
responses %>% freqs(QAGEGROUP, QSEX) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
)
)
responses %>% freqs(QAGEGROUP, QSEX) %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
)
)
responses %>% freqs(QAGEGROUP, QSEX) %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
)
)
responses %>% freqs(QAGEGROUP, QSEX) %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4
) %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4
) %>%
filter(lbale == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4
) %>%
filter(label == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA1_13,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
#### ***** OTHER FUNCTIONS ***** ####
#### topline ####
responses$QFREQPARK_AREA1_13 <- as_factor(QFREQPARK_AREA1_13)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA1_13,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
#### ***** OTHER FUNCTIONS ***** ####
#### topline ####
responses$QFREQPARK_AREA1_13 <- as_factor(responses$QFREQPARK_AREA1_13)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA1_13,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA1_13,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
)
responses %>% freqs(QFREQPARK_AREA1_13)
#### ***** OTHER FUNCTIONS ***** ####
#### topline ####
zero <- tibble(
variable = 'QFREQPARK_AREA1_13',
label = 'On',
n = 0,
result = 0
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero)  %>%
group_by(variable) %>%
mutate(
percent_label = case_when(
label == label[1] ~ str_c(result * 100, '%'),
T ~ str_c(result * 100)
),
percent_label = case_when(
label == label[1] & percent_label =='0%' & n >= 1 ~ '<1%',
percent_label == '0%' & n >= 1 ~ '<1',
T ~ percent_label
)
)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero) %>%
str_split(variable, '_')
?str_split
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero) %>%
str_split(variable, '_')
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero)
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero) %>%
str_split(variable, 'A')
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero) %>%
str_split('_')
responses %>% freqs(
QFREQPARK_AREA1_1,
QFREQPARK_AREA1_2,
QFREQPARK_AREA1_3,
QFREQPARK_AREA1_4,
QFREQPARK_AREA2_1,
QFREQPARK_AREA2_2,
QFREQPARK_AREA2_3,
QFREQPARK_AREA2_4
) %>%
filter(label == 'On') %>%
bind_rows(zero) %>%
str_split(string = variable)
?separate
