percent_size = 6
) {
ggplot(
data = frequencies,
aes(
x = x_var,
y = result,
fill = grouped_var
)
) +
geom_bar(
stat = 'identity',
width = 0.75,
position = 'fill'
) +
geom_text(
aes(
label = percent_label,
color = grouped_var
),
position = position_fill(vjust = 0.5),
family = 'flama',
size = percent_size
) +
coord_flip() +
scale_color_manual(
guide = F,
values = colors
) +
scale_fill_manual(
guide = guide_legend(reverse = TRUE),
values = rev(fills)
) +
theme_minimal() +
theme(
axis.title = element_blank(),
panel.grid = element_blank(),
axis.text.y = element_text(size = 12),
axis.text.x = element_blank(),
legend.title = element_blank(),
legend.position = 'top'
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 50, simplify = FALSE), paste, collapse="\n"))
}
#Colors / Fonts
font_add(
family='flama',
regular='Flama-Medium.otf',
bold='Flama-Bold.otf'
)
font_type <- theme(text=element_text(family='flama'))
showtext_auto()
green <- '#4C731E'
blue <- '#1E4C73'
grey <- '#666666'
region_colors <- c(
'#FFA59A', #1, red
'#AAcc90', #2, green
'#a8abc6', #3, blue
'#f5d69b' #4, yellow/orange
)
district1 <- '#FFA59A' #1, red
district2 <- '#AAcc90' #2, green
district3 <- '#a8abc6' #3, blue
district4 <- '#f5d69b' #4, yellow/orange
div5fill <- c(
'#4C731E',
'#8FA872',
'#D2DCC7',
'#728FA8',
'#1E4C73'
)
div5col <- c(
'#4C731E',
'#4C731E',
'#4C731E',
'#1E4C73',
'#1E4C73'
)
div5lab <- c(
'white',
'white',
'#666666',
'white',
'white'
)
div5fill2 <- c(
'#1E4C73',
'#728FA8',
'#D2DCC7',
'#8FA872',
'#4C731E'
)
div5fill3 <- c(
'#1E4C73',
'#728FA8',
'#AAADA7',
'#8FA872',
'#4C731E'
)
div5col2 <- c(
'#1E4C73',
'#1E4C73',
'#4C731E',
'#4C731E',
'#4C731E'
)
sca5fill <- c(
'#4C731E',
'#799656',
'#A6B98F',
'#D2DCC7',
'#E9EDE3'
)
sca5col <- c(
'#4C731E',
'#4C731E',
'#4C731E',
'#4C731E',
'#4C731E'
)
bar1_hor <- function(
data = frequencies,
result = frequencies$result,
label = frequencies$label,
percent_label = frequencies$percent_label,
spaces = 100,
percent_size = 10,
color1 = green,
nudge = -.35
) {
chart <- ggplot(
frequencies,
aes(
x = label,
y = result,
fill = color1,
color = color1
)
) +
geom_bar(
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label
),
family = "flama",
position = position_dodge(width = .9),
hjust = nudge,
size = percent_size
) +
scale_fill_manual(
values = c(color1)
) +
scale_color_manual(
guide = FALSE,
values = c(color1)
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = 14),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.x = element_blank(),
strip.text = element_text(size = 12),
legend.position = "none"
) +
coord_flip()
}
groupedbar <- function(
data = frequencies,
result = frequencies$result,
label = frequencies$label,
source = frequencies$group_var,
percent_label = frequencies$percent_label,
spaces = 10,
percent_size = 10,
axis_text_size = 12
) {
chart <- ggplot(
frequencies,
aes(
x = label,
y = result,
group = source
)
) +
geom_bar(
aes(
fill = source
),
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label,
color = source
),
family = "flama",
position = position_dodge(width = .9),
vjust = -.5,
size = percent_size
) +
scale_fill_manual(
values = region_colors
) +
scale_color_manual(
guide = FALSE,
values = region_colors
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = axis_text_size),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.y = element_blank(),
strip.text = element_text(size = 12),
legend.position = "top"
)
}
groupedbar_hor <- function(
data = frequencies,
result = frequencies$result,
label = frequencies$label,
source = frequencies$group_var,
percent_label = frequencies$percent_label,
spaces = 100,
percent_size = 10,
axis_text_size = 12,
colors = region_colors,
nudge = -.35
) {
chart <- ggplot(
frequencies,
aes(
x = label,
y = result,
group = source
)
) +
geom_bar(
aes(
fill = source
),
stat = "identity",
width = .75,
position = position_dodge(width = .9)
) +
geom_text(
aes(
label = percent_label,
color = source
),
family = "flama",
position = position_dodge(width = .9),
hjust = nudge,
size = percent_size
) +
scale_fill_manual(
values = colors
) +
scale_color_manual(
guide = FALSE,
values = colors
) +
scale_y_percent(
limits = c(0, max(frequencies$result) + ifelse(max(frequencies$result) > .5, .12, .07))
) +
scale_x_discrete(labels = function(x) lapply(strwrap(x, width = spaces, simplify = FALSE), paste, collapse="\n")) +
theme_minimal() +
theme( legend.text = element_text(size = 12),
axis.text = element_text(size = axis_text_size),
panel.grid = element_blank(),
axis.title = element_blank(),
legend.title = element_blank(),
axis.text.x = element_blank(),
strip.text = element_text(size = 12),
legend.position = "top"
) +
guides(fill = guide_legend(reverse = T)) +
coord_flip()
}
names <- names(responses) %>% as_tibble()
#### Function documentation ####
ls('package:orderlabel') #look at all functions in package
?order_label
?other_rm
?topline
?read_excel_allsheets
#### Test if no label ####
#ungrouped
frequencies <- ungrouped_freqs %>%
select(
variable,
result
) %>%
order_label(
label_var = variable
)
chart <- bar1()
chart
#grouped
frequencies <- grouped_freqs %>%
select(
district,
variable,
result
) %>%
order_label(
group_var = district,
label_var = variable
)
chart <- groupedbar()
chart
#### Testing function ungrouped ####
rm(frequencies)
frequencies <- ungrouped_freqs %>%
order_label(
#horizontal = T,
#inherent_order_label = T,
#rev_label = T,
#label_specific = 'Two',
# label_var = stat
)
chart <- bar1()
#chart <- bar1_hor()
chart
ggchart_save('test')
#### Testing with grouped variables ####
rm(frequencies)
frequencies <- grouped_freqs %>%
order_label(
group_var = district,
horizontal = T,
#inherent_order_label = T,
#inherent_order_group = T,
#rev_label = T,
#rev_group = T,
#label_specific = 'Two',
#group_specific = 'District 2'
)
chart <- groupedbar_hor()
#chart <- groupedbar()
chart
ggchart_save('test')
#### Testing Stacked bars ####
rm(frequencies)
#Not grouped
frequencies <- responses %>%
filter(district == 'District 1') %>%
freqs(
QCURRENT1,
nas = F,
wt = weights
) %>%
mutate(
variable = NA
) %>%
order_label(
#inherent_order_label = T
stacked = T,
#rev_label = T
)
chart <- bar1()
chart
chart <- stacked_bar(
x_var = frequencies$variable
)
chart
ggchart_save('test')
#grouped
frequencies <- responses %>%
filter(!is.na(district)) %>%
group_by(district) %>%
freqs(
QCURRENT1,
nas = F,
wt = weights
) %>%
mutate(
variable = NA
) %>%
order_label(
group_var = district,
stacked = T,
#inherent_order_group = T,
#rev_group = T,
#rev_label = T
group_specific = 'District 3'
)
chart <- stacked_bar()
chart
ggchart_save('test')
#### Testing mscharts ####
text_settings_grouped <- list(
'District 1' = fp_text(font.size = 16, color = district1),
'District 2' = fp_text(font.size = 16, color = district2),
'District 3' = fp_text(font.size = 16, color = district3),
'District 4' = fp_text(font.size = 16, color = district4)
)
color_settings_grouped <- list(
'District 1' = district1,
'District 2' = district2,
'District 3' = district3,
'District 4' = district4
)
text_settings_stacked <- list(
'Strongly agree' = fp_text(font.size = 26, color = "white"),
'Somewhat agree' = fp_text(font.size = 26, color = "white"),
'Neither agree nor disagree' = fp_text(font.size = 26, color = "black"),
'Somewhat disagree' = fp_text(font.size = 26, color = "white"),
'Strongly disagree' = fp_text(font.size = 26, color = "white")
)
color_settings_stacked <- list(
'Strongly agree' = '#97D700',
'Somewhat agree' = '#BEE660',
'Neither agree nor disagree' = '#E8E9EF',
'Somewhat disagree' = '#8B90AE',
'Strongly disagree' = '#464E7E'
)
#Vertical
rm(frequencies)
frequencies <- grouped_freqs %>%
order_label(
group_var = district,
#inherent_order_label = T,
#inherent_order_group = T,
#label_specific = 'Two',
#group_specific = 'District 4'
)
chart_ms_grouped <- bar_grouped()
#Horizontal
frequencies <- grouped_freqs %>%
order_label(
group_var = district,
horizontal = T,
inherent_order_label = T,
#rev_label = T,
#inherent_order_group = T,
#rev_group = T,
#label_specific = 'Four',
#group_specific = 'District 2' #TT (groups jumbled)
)
chart_ms_grouped_hor <- bar_grouped(direction = 'horizontal')
#Stacked single
rm(frequencies)
frequencies <- responses %>%
freqs(
QCURRENT1,
nas = F,
wt = weights
) %>%
order_label(
ms_stacked = T,
#rev_label = T
)
chart_ms_stacked_single <-bar_stacked(
x_var = 'variable',
axis_x_display = F
)
#Stacked grouped
responses <- responses %>%
mutate(
factor_test = as_factor(QCURRENT1)
)
rm(frequencies)
frequencies <- responses %>%
filter(!is.na(district)) %>%
group_by(district) %>%
freqs(
factor_test,
nas = F,
wt = weights
) %>%
order_label(
group_var = district,
ms_stacked = T,
#rev_group = T,
#inherent_order_group = T,
#group_specific = 'District 2'
)
chart_ms_stacked <- bar_stacked()
doc <- read_pptx('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Statsivus for the Restivus/Order label, NSM/Charts/test template.pptx')
add1c(chart_ms_grouped)
add1c(chart_ms_grouped_hor)
add1c(chart_ms_stacked_single)
add1c(chart_ms_stacked)
print(doc,'~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Statsivus for the Restivus/Order label, NSM/Charts/test ms charts.pptx')
library(devtools)
library(roxygen2)
#Process documentation
setwd('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Resources/Packages/orderlabel/')
document()
library(y2clerk)
ls(y2clerk)
ls('package:y2clerk')
?freq_mean
