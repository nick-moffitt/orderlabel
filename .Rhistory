inherent_order_group,
specifically_ordered,
rev_group
){
if(inherent_order_label == T &
specifically_ordered == F
){
dataset <- dataset %>%
dplyr::arrange(
group_var, value, result
) %>%
reverse_group(rev_group) %>%
dplyr::mutate(
label = forcats::fct_inorder(label),
percent_label = ifelse(
label == label[1] & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
)
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
)
} else{
dataset <- dataset
}
}
#### (5) Grouped Unordered Section ####
section_grouped_unordered <- function(
dataset,
specifically_ordered,
label_specific,
inherent_order_label,
group_var,
inherent_order_group,
group_specific,
specifically_ordered_group,
rev_group,
rev_label
) {
if(specifically_ordered_group == F &
inherent_order_group == F
){
dataset <- dataset %>%
dplyr::ungroup() %>%
dplyr::mutate(
group_var = as_factor(group_var),
group_var = as.character.factor(group_var)
)
dataset <- grouped_unordered1(dataset, inherent_order_label, inherent_order_group, specifically_ordered, label_specific, rev_group, rev_label)
dataset <- grouped_unordered2(dataset, inherent_order_label, inherent_order_group, specifically_ordered, label_specific, rev_group)
dataset <- grouped_unordered3(dataset, inherent_order_label, inherent_order_group, specifically_ordered, rev_group, rev_label)
dataset <- grouped_unordered4(dataset, inherent_order_label, inherent_order_group, specifically_ordered, rev_group)
} else {
dataset <- dataset
}
return(dataset)
}
#### Grouped Unordered 1 ####
grouped_unordered1 <- function(
dataset,
inherent_order_label,
inherent_order_group,
specifically_ordered,
label_specific,
rev_group,
rev_label
){
if(specifically_ordered == T &
inherent_order_label == F){
freqs1 <- dataset %>%
dplyr::filter(
label == label_specific
) %>%
dplyr::arrange(
desc(result)
) %>%
reverse_label_unordered(rev_label) %>%
reverse_group(rev_group)
group1 <- freqs1$group_var[1]
freqs2 <- dataset %>%
dplyr::filter(
label != label_specific &
group_var == group1
) %>%
dplyr::arrange(
desc(result)
)
freqs3 <- dataset %>%
dplyr::filter(
label != label_specific &
group_var != group1
)
dataset <- dplyr::bind_rows(freqs1, freqs2, freqs3) %>%
dplyr::mutate(
percent_label = ifelse(
label == label_specific & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
),
label = forcats::fct_inorder(label)
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
)
} else{
dataset <- dataset
}
}
#### Grouped Unordered 2 ####
grouped_unordered2 <- function(
dataset,
inherent_order_label,
inherent_order_group,
specifically_ordered,
label_specific,
rev_group
){
if(specifically_ordered == T &
inherent_order_label == T){ #Arranging for specific label first
freqs1 <- dataset %>%
dplyr::filter(
label == label_specific
) %>%
dplyr::arrange(
value, desc(result), group_var
) %>% reverse_group(rev_group)
group1 <- freqs1$group_var[1]
freqs2 <- dataset %>%
dplyr::filter(
label != label_specific &
group_var == group1
) %>%
dplyr::arrange(
value
)
freqs3 <- dataset %>%
dplyr::filter(
label != label_specific &
group_var != group1
)
dataset <- dplyr::bind_rows(freqs1, freqs2, freqs3) %>%
dplyr::mutate(
percent_label = ifelse(
label == label_specific & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
),
label = forcats::fct_inorder(label)
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
)
} else{
dataset <- dataset
}
}
#### Grouped Unordered 3 ####
grouped_unordered3 <- function(
dataset,
inherent_order_label,
inherent_order_group,
specifically_ordered,
rev_group,
rev_label
){
if(inherent_order_label == F &
specifically_ordered == F
){
freqs1 <- dataset %>%
dplyr::arrange(
desc(result)
)  %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
) %>%
reverse_label_unordered(rev_label) %>%
dplyr::filter(
label == label[1]
) %>% reverse_group(rev_group)
group1 = freqs1$label[1]
freqs2 <- dataset %>%
dplyr::filter(
label != group1
) %>%
dplyr::arrange(
desc(result)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
) %>% reverse_label_unordered(rev_label)
dataset <- dplyr::bind_rows(freqs1, freqs2) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var),
percent_label = ifelse(
label == group1 & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
)
} else{
dataset <- dataset
}
}
#### Grouped Unordered 4 ####
grouped_unordered4 <- function(
dataset,
inherent_order_label,
inherent_order_group,
specifically_ordered,
rev_group
){
if(inherent_order_label == T &
specifically_ordered == F
)
{
dataset <- dataset %>%
dplyr::arrange(
value, desc(result), group_var
) %>% reverse_group(rev_group) %>%
dplyr::mutate(
label = forcats::fct_inorder(label),
percent_label = ifelse(
label == label[1] & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
)
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
)
} else{
dataset <- dataset
}
}
#### topbox ####
topbox <- function(
dataset,
topbox = NULL
) {
if(is.null(topbox) == F){
top2box <- topbox + 1
dataset <- spreading_top2(dataset, top2box)
dataset <- ordering_top2(dataset)
} else{ #is.null(topbox)
dataset <- dataset
}
}
### spreading_top2
spreading_top2 <- function(dataset, top2box) {
test1 <- dataset %>%
dplyr::select(
-result
)
test2 <- dataset %>%
dplyr::mutate(value1 = value) %>%
dplyr::select(
group_var,
value1,
result
) %>%
tidyr::spread(
key = value1,
value = result
) %>%
dplyr::mutate(
topbox = dplyr::select(., 2:top2box) %>%
rowSums(na.rm = T)
) %>%
tidyr::gather(
key = value,
value = result,
-group_var,
-topbox
) %>%
dplyr::mutate(
value = as.numeric(value)
)
dataset <- dplyr::left_join(
test1,
test2
)
}
### ordering_top2
ordering_top2 <- function(dataset) {
dataset <- dataset %>%
dplyr::arrange(
topbox %>% desc
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
) %>%
dplyr::mutate(
percent_label = ifelse(
label == label[1] & group_var == group_var[1],
stringr::str_c(result * 100, '%'),
stringr::str_c(result * 100)
)
)
}
#### Horizontal ####
horizontal_chart <- function(
dataset,
horizontal,
grouped
){
if(horizontal == T){
if(grouped == F){
dataset <- dataset %>%
dplyr::mutate(
label = forcats::fct_rev(label)
)
} else{ #grouped == T
dataset <- dataset %>%
dplyr::mutate(
label = forcats::fct_rev(label)
) %>%
dplyr::mutate(
group_var = forcats::fct_rev(group_var)
)
}
} else{
dataset <- dataset
}
}
#### Stacked ####
stacked_chart <- function(
dataset,
stacked,
grouped,
inherent_order_group,
specifically_ordered
){
if(stacked == 'gg' &
grouped == F){
dataset <- dataset  %>%
dplyr::mutate(
label = forcats::fct_rev(label)
)
} else if(stacked == 'gg' &
grouped == T){
dataset <- dataset %>%
dplyr::mutate(
label = forcats::fct_rev(label)
) %>%
dplyr::mutate(
group_var = forcats::fct_rev(group_var)
)
} else{
dataset <- dataset
}
}
#### MS Stacked ####
stacked_chart_ms <- function(
dataset,
stacked,
grouped,
inherent_order_group,
specifically_ordered_group
){
if(stacked == 'ms' &
grouped == T){
dataset <- dataset %>%
dplyr::mutate(
group_var = forcats::fct_rev(group_var)
)
} else{
dataset <- dataset
}
}
#### None / Other ####
none_other <- function(
dataset,
none_other,
grouped
){
if(none_other == T){
dataset <- dataset %>%
dplyr::arrange(
label = forcats::fct_relevel(
label,
"Other",
'None of the above',
"Prefer not to say",
after = Inf
)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label),
percent_label = ifelse(
label == label[1],
str_c(result * 100, '%'),
str_c(result * 100)
)
)
} else{
dataset <- dataset
}
#For grouped
if(grouped == T & none_other == T){
dataset <- dataset %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var),
percent_label = ifelse(
label == label[1] & group_var == group_var[1],
str_c(result * 100, '%'),
str_c(result * 100)
)
)
} else{
dataset <- dataset
}
}
frequencies <- tibble(
label = c(
'Brand 1',
'Brand 2',
'Brand 3',
'Brand 4',
'Brand 5',
'Other, please specify',
'Prefer not to say',
'I find none of these brand appealing',
'Brand 6',
'Brand 7 (some description)'
),
result = c(1:10)
)
View(frequencies)
frequencies <- tibble(
label = c(
'Brand 1',
'Brand 2',
'Brand 3',
'Brand 4',
'Brand 5',
'Other, please specify',
'Prefer not to answer',
'I find none of these brand appealing',
'Brand 6',
'Brand 7 (some description)'
),
result = c(1:10)
)
frequencies <- frequencies %>% other_rm()
other_rm <- function(
dataset
) {
#Remove for 'label' var
dataset <- dataset %>%
mutate(
label = as.character(label),
label = dplyr::case_when(
stringr::str_detect(label, regex('prefer not to', ignore_case = T)) == T ~ 'Prefer not to say',
stringr::str_detect(label, regex('please specify', ignore_case = T)) == T ~ 'Other',
stringr::str_detect(label, regex('none of the', ignore_case = T)) == T ~ 'None of the above',
label == 'None' ~ 'None of the above',
T ~ label
),
label = str_remove_all(label, ' \\(.*')
)
#Remove for 'variable' var
if(any(names(dataset) == 'variable') == T){
dataset <- dataset %>%
mutate(
variable = as.character(variable),
variable = dplyr::case_when(
stringr::str_detect(label, regex('prefer not to', ignore_case = T)) == T ~ 'Prefer not to say',
stringr::str_detect(variable, regex('please specify', ignore_case = T)) == T ~ 'Other',
stringr::str_detect(variable, regex('none of the', ignore_case = T)) == T ~ 'None of the above',
variable == 'None' ~ 'None of the above',
T ~ variable
),
variable = str_remove_all(variable, ' \\(.*')
)
} else{
dataset <- dataset
}
}
frequencies <- tibble(
label = c(
'Brand 1',
'Brand 2',
'Brand 3',
'Brand 4',
'Brand 5',
'Other, please specify',
'Prefer not to answer',
'I find none of these brand appealing',
'Brand 6',
'Brand 7 (some description)'
),
result = c(1:10)
)
frequencies <- frequencies %>% other_rm()
frequencies <- frequencies %>% other_rm() %>% order_label()
devtools::install_github('y2analytics/y2clerk')
devtools::install_github('nick-moffitt/y2artisan')
#devtools::install_github('nick-moffitt/y2artisan')
library(y2artisan)
ls('package:y2artisan')
#devtools::install_github('nick-moffitt/y2artisan')
library(y2artisan)
?gg_single
chart <- gg_single()
chart <- y2artisan::gg_single()
