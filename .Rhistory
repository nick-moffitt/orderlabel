ungroup() %>%
orderlabel::order_same()
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup() %>%
order_same()
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup()
order_same <- function(
dataset,
orders = ordered_df,
grouped = 'NULL'
) {
label_flag <- purrr::as_vector(orders$label) %>% levels()
#run ordering functions
if(
(any(names(orders) == 'group_var') == T |
names(dataset)[1] != 'variable'
)
) {
group_flag <- purrr::as_vector(orders$group_var) %>% levels()
dataset <- grouped_vector(dataset, label_flag1 = label_flag, group_flag1 = group_flag)
} else{ #NOT grouped
dataset <- ungrouped_vector(dataset, label_flag1 = label_flag)
}
}
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup()
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup() %>%
order_same()
View(frequencies)
order_same <- function(
dataset,
orders = ordered_df
) {
label_flag <- purrr::as_vector(orders$label) %>% levels()
#run ordering functions
if(any(names(orders) == 'group_var') == T |
names(dataset)[1] != 'variable'
) {
group_flag <- purrr::as_vector(orders$group_var) %>% levels()
dataset <- grouped_vector(dataset, label_flag1 = label_flag, group_flag1 = group_flag)
} else{ #NOT grouped
dataset <- ungrouped_vector(dataset, label_flag1 = label_flag)
}
}
#### ***** Hidden Functions ***** ####
#### Grouped ####
grouped_vector <- function(
dataset,
label_flag1 = label_flag,
group_flag1 = group_flag
){
dataset %>%
dplyr::ungroup() %>%
dplyr::arrange(
#first arrange by groups
group_var = forcats::fct_relevel(
group_var,
group_flag1
),
#then arrange by labels, now in order of both
label = forcats::fct_relevel(
label,
label_flag1
)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
) %>%
dplyr::mutate(
group_var = forcats::fct_inorder(group_var)
) %>%
dplyr::mutate(
percent_label =  stringr::str_c(result * 100)
)
}
#### ungrouped ####
ungrouped_vector <- function(
dataset,
label_flag1 = label_flag
) {
dataset %>%
dplyr::arrange(
label = forcats::fct_relevel(
label,
label_flag1
)
) %>%
dplyr::mutate(
label = forcats::fct_inorder(label)
) %>%
dplyr::mutate(
percent_label = stringr::str_c(result * 100)
)
}
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup() %>%
order_same()
#### Data ####
devtools::install_github('nick-moffitt/orderlabel')
#### Data ####
devtools::install_github('nick-moffitt/orderlabel')
library(haven)
library(tidyverse)
library(y2clerk)
library(mschart)
library(officer)
library(y2artisan)
library(orderlabel)
library(labelled)
responses1 <- read_sav('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Projects/Qualtrics/Service Now/Data/ServiceNow_Market_Assessment_August 27, 2019_10.47.sav')
oe1 <- read_csv('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Projects/Qualtrics/Service Now/Data/open ends/why easy to do business CODED.csv')
oe2 <- read_csv('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Projects/Qualtrics/Service Now/Data/open ends/additional feedback CODED.csv')
oe3 <- read_csv('~/Dropbox (Y2 Analytics)/Y2 Analytics Team Folder/Projects/Qualtrics/Service Now/Data/open ends/why NPS score CODED.csv')
responses <- left_join(
responses1,
oe1
) %>% left_join(
oe2
) %>%
left_join(
oe3
)
#Colors
green_dark <- '#76ac98'
green_light <- '#A9CBBF'
red_darkest <- '#855353'
red_dark <- '#d58485'
red_light <- '#E5B2B3'
add1s_y2 <- function(
text_boxes = T,
slide_name = "Title Only with Subtitle",
master_name = "Office Theme"
) {
doc <- officer::add_slide(
doc,
layout = slide_name,
master = master_name
)
if(text_boxes == T){
doc <- officer::ph_with_text(
doc,
type = 'title',
str = 'xxx'
)
doc <- officer::ph_with_text(
doc,
type = 'body',
str = 'xxx'
)
} else{
doc <- doc
}
}
add1c_y2_new  <- function(name){
add1c_y2(name, slide_name = "Title Only with Subtitle", text_boxes = F)
}
names <- taking_names()
#### Top2box Overall ####
# Make top2box
responses <- responses %>%
mutate_at(
vars(
Q9_A:Q18,
-Q9_B,
-ends_with('NPS_GROUP')
),
funs(
col = case_when(
. %in% c(9,10) ~ "Keep",
TRUE ~ "Remove"
)
)
)
names <- taking_names()
# ServiceNow
freqs1 <- responses %>%
filter(
benchmark == 'ServiceNow'
) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col,
prompt = T
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
group_var = 'ServiceNow'
)
#Overall
freqs2 <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col,
prompt = T
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
group_var = 'Overall'
)
frequencies <- bind_rows(
freqs1,
freqs2
) %>%
order_label(
group_var = group_var,
horizontal = T,
group_specific = 'ServiceNow'
)
ordered_df <- frequencies
color_settings_grouped <- list(
'ServiceNow' = green_dark,
'Overall' = green_light
)
text_settings_grouped <- list(
'ServiceNow' =  fp_text(color = green_dark, font.size = 10),
'Overall' = fp_text(color = green_light, font.size = 10)
)
top2boxscores <- ms_grouped_y2(
direction = 'horizontal'
)
#### Top2Box by NPS group ####
responses %>% freqs(Q7_NPS_GROUP)
responses <- responses %>%
mutate(
nps_2group = ifelse(
Q7_NPS_GROUP == 3,
'Promoters',
'Passives/Detractors'
)
)
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup() %>%
order_same() %>%
arrange(label = fct_rev(label)) %>%
select(
test,
label,
result
) %>%
spread(
key = test,
value = result
) %>%
arrange(
label = fct_relevel(
label,
"Ease of doing business",
"Overall experience using the platform",
"Achieve desired outcomes",
"Ease of using the platform",
"Overall technical support experience",
"Cares about future success",
"Account management team experience",
"Strong return on investment",
"Pricing"
)
)
View(frequencies)
frequencies <- responses %>%
filter(
benchmark != 'ServiceNow'
) %>%
group_by(nps_2group) %>%
freqs(
Q9_A_col,
Q10_col,
Q11_col,
Q12_col,
Q13_col,
Q14_col,
Q15_col,
Q17_col,
Q18_col
) %>%
filter(label == 'Keep') %>%
mutate(
label = case_when(
variable == "Q9_A_col"~ "Ease of doing business",
variable == "Q10_col" ~ "Cares about future success",
variable == "Q11_col" ~ "Achieve desired outcomes",
variable == "Q12_col" ~ "Overall experience using the platform",
variable == "Q13_col" ~ "Ease of using the platform",
variable == "Q14_col" ~ "Strong return on investment",
variable == "Q15_col" ~ "Pricing",
variable == "Q17_col" ~ "Account management team experience",
variable == "Q18_col" ~ "Overall technical support experience"
),
test = group_var
) %>%
ungroup() %>%
order_same()
